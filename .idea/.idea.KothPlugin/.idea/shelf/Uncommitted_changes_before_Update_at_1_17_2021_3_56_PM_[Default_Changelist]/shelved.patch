Index: KothPlugin/Koth.cs
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>using System;\r\nusing System.IO;\r\nusing System.Text;\r\nusing System.Windows.Controls;\r\nusing System.Xml.Serialization;\r\nusing Discord;\r\nusing Discord.Webhook;\r\nusing NLog;\r\nusing Sandbox;\r\nusing Sandbox.ModAPI;\r\nusing Torch;\r\nusing Torch.API;\r\nusing Torch.API.Managers;\r\nusing Torch.API.Session;\r\nusing Torch.Session;\r\n\r\n\r\nnamespace KothPlugin\r\n{\r\n    public class Koth : TorchPluginBase\r\n    {\r\n        public static readonly Logger Log = LogManager.GetCurrentClassLogger();\r\n        public static string KothScorePath = \"\";\r\n        private Persistent<KothPluginConfig> _config;\r\n        private KothPluginControl _control;\r\n        private TorchSessionManager _sessionManager;\r\n        public KothPluginConfig Config => _config?.Data;\r\n\r\n        public UserControl GetControl()\r\n        {\r\n            return _control ?? (_control = new KothPluginControl(this));\r\n        }\r\n\r\n        public override void Init(ITorchBase torch)\r\n        {\r\n            base.Init(torch);\r\n            SetupConfig();\r\n            \r\n            _sessionManager = Torch.Managers.GetManager<TorchSessionManager>();\r\n            _sessionManager.SessionStateChanged += SessionManagerOnSessionStateChanged;\r\n            \r\n        }\r\n\r\n        private void SessionManagerOnSessionStateChanged(ITorchSession session, TorchSessionState newstate)\r\n        {\r\n            switch (newstate)\r\n            {\r\n                case TorchSessionState.Loading:\r\n                    break;\r\n                case TorchSessionState.Loaded:\r\n                    SetPath();\r\n                    WebService.StartWebServer();\r\n                    //SetupNetwork();\r\n                    MyAPIGateway.Multiplayer.RegisterSecureMessageHandler(8008, HandleIncomingPacket);\r\n                    break;\r\n                case TorchSessionState.Unloading:\r\n                    break;\r\n                case TorchSessionState.Unloaded:\r\n                    WebService.StopWebServer();\r\n                    break;\r\n                default:\r\n                    throw new ArgumentOutOfRangeException(nameof(newstate), newstate, null);\r\n            }\r\n        }\r\n        \r\n        \r\n        \r\n        private void HandleIncomingPacket(ushort comId, byte[] msg ,ulong id, bool relible)\r\n        {\r\n            try\r\n            {\r\n                string message = Encoding.ASCII.GetString(msg);\r\n                SendDiscordWebHook(\"</reloadisgay>\", message);\r\n                \r\n            }\r\n            catch (Exception error)\r\n            {\r\n                Log.Error(error, \"server error\");\r\n            }\r\n        }\r\n        \r\n        private void SetupConfig()\r\n        {\r\n            var configFile = Path.Combine(StoragePath, \"KothPluginConfig.cfg\");\r\n            try\r\n            {\r\n                _config = Persistent<KothPluginConfig>.Load(configFile);\r\n            }\r\n            catch (Exception e)\r\n            {\r\n                Log.Warn(e);\r\n            }\r\n\r\n            if (_config?.Data != null) return;\r\n            Log.Info(\"Creating Default Config\");\r\n            _config = new Persistent<KothPluginConfig>(configFile, new KothPluginConfig());\r\n            _config.Save();\r\n        }\r\n\r\n        public void Save()\r\n        {\r\n            _config.Save();\r\n        }\r\n\r\n\r\n        private void SetPath()\r\n        {\r\n            var kothScoreName = MySandboxGame.ConfigDedicated.LoadWorld;\r\n            KothScorePath = Path.Combine(kothScoreName, @\"Storage\\2002161364.sbm_NewKoth\\Scores.data\");\r\n            if (!File.Exists(KothScorePath)) Log.Error(\"KOTH PLUGIN: NO SOCRE DATA, PLUGIN WILL FAIL\");\r\n        }\r\n        \r\n        public static session ScoresFromStorage()\r\n\r\n        {\r\n            var serializer = new XmlSerializer(typeof(session));\r\n            using (var reader = new StreamReader(KothScorePath))\r\n            {\r\n                return (session) serializer.Deserialize(reader);\r\n            }\r\n        }\r\n        public async void SendDiscordWebHook(string title, string msg)\r\n        {\r\n            const string webhookUrl = \"https://discordapp.com/api/webhooks/800156920270815253/U05QvvZqSUm5iTLmEtLiIFJyGg19JR6rLOb16v6L05qraMypR6kpcQZSeD1NHegLb5Ip\"; //TODO Config\r\n            using (var client = new DiscordWebhookClient(webhookUrl))\r\n            {\r\n                var embed = new EmbedBuilder\r\n                {\r\n                    Title = title,\r\n                    Description = msg\r\n                };\r\n                await client.SendMessageAsync(\"\", embeds: new[] {embed.Build()});\r\n            }\r\n        }\r\n    }\r\n}
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/KothPlugin/Koth.cs b/KothPlugin/Koth.cs
--- a/KothPlugin/Koth.cs	(revision b3733404c6ed3bbac4603d7c991657b5ddc7d6e5)
+++ b/KothPlugin/Koth.cs	(date 1610916966848)
@@ -50,7 +50,6 @@
                 case TorchSessionState.Loaded:
                     SetPath();
                     WebService.StartWebServer();
-                    //SetupNetwork();
                     MyAPIGateway.Multiplayer.RegisterSecureMessageHandler(8008, HandleIncomingPacket);
                     break;
                 case TorchSessionState.Unloading:
@@ -63,8 +62,6 @@
             }
         }
         
-        
-        
         private void HandleIncomingPacket(ushort comId, byte[] msg ,ulong id, bool relible)
         {
             try
@@ -119,7 +116,7 @@
                 return (session) serializer.Deserialize(reader);
             }
         }
-        public async void SendDiscordWebHook(string title, string msg)
+        public static async void SendDiscordWebHook(string title, string msg)
         {
             const string webhookUrl = "https://discordapp.com/api/webhooks/800156920270815253/U05QvvZqSUm5iTLmEtLiIFJyGg19JR6rLOb16v6L05qraMypR6kpcQZSeD1NHegLb5Ip"; //TODO Config
             using (var client = new DiscordWebhookClient(webhookUrl))
